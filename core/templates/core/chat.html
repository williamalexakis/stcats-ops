{% extends "base.html" %}
{% load core_extras %}

{% block title %}Chat - CS Dept Platform{% endblock %}

{% block content %}

<div class="page-header">
    <div class="page-header__group">
        <h1 class="page-header__title">Chat</h1>

        <div class="count-badge-wrapper">
            <span class="count-badge">
                {{ room.name }}
            </span>
        </div>
    </div>
</div>

<div id="chat-messages" data-partial-url="{% url 'chat' %}?partial=1">
    {% include "core/partials/chat_messages.html" %}
</div>

<div class="card">
    <h3 class="form-section__title">
        <i class="fa-solid fa-paper-plane"></i> Send Message
    </h3>

    <form method="post"
          class="form-vertical"
          data-ajax="json"
          data-ajax-refresh="{% url 'chat' %}?partial=1"
          data-ajax-target="#chat-messages"
          data-ajax-reset="true">

        {% csrf_token %}

        <div>
            <textarea
                id="body"
                name="body"
                rows="4"
                placeholder="Type your message here..."
                required
                class="textarea-input"
            ></textarea>
        </div>

        {% if request.user|is_admin %}
            <div class="form-options">
                <label class="form-option">
                    <input
                        type="checkbox"
                        id="is_announcement"
                        name="is_announcement"
                        class="form-option__checkbox"
                        onchange="document.getElementById('pinned-option').style.display = this.checked ? 'flex' : 'none';"
                    />

                    <span class="form-option__label">
                        <i class="fa-solid fa-bullhorn icon-teacher"></i> Mark as Announcement
                    </span>
                </label>

                <label id="pinned-option" class="form-option form-option--hidden">
                    <input
                        type="checkbox"
                        id="is_pinned"
                        name="is_pinned"
                        class="form-option__checkbox"
                    />

                    <span class="form-option__label">
                        <i class="fa-solid fa-thumbtack icon-success"></i> Pin Announcement
                    </span>
                </label>
            </div>
        {% endif %}

        <div>
            <button type="submit" class="chat-submit">
                <i class="fa-solid fa-paper-plane"></i>

                Send Message

            </button>
        </div>
    </form>
</div>

{% endblock %}
