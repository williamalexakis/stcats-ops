<!-- Copyright Â© William Alexakis. All Rights Reserved. Use governed by LICENSE file. -->

{% extends "base.html" %}

{% block title %}Create Schedule Entry - CS Dept Platform{% endblock %}

{% block content %}

<div class="page-subheader">
    <a href="{% url 'scheduler' %}" class="back-link">
        <i class="fa-solid fa-arrow-left"></i> Back to Scheduler
    </a>

    <h2 class="page-subheader__title">Create Schedule Entry</h2>
</div>

<div class="card">
    <form method="post" class="form-grid">

        {% csrf_token %}

        <div class="form-grid-two">
            <div>
                <label for="teacher" class="field-label">
                    <i class="fa-solid fa-chalkboard-user"></i> Teacher
                </label>

                <select
                    id="teacher"
                    name="teacher"
                    required
                    class="select-control"
                >
                    <option value="">Select teacher...</option>

                    {% for teacher in teachers %}

                        <option value="{{ teacher.id }}">{{ teacher|display_name }}</option>

                    {% endfor %}

                </select>
            </div>

            <div>
                <label for="classroom" class="field-label">
                    <i class="fa-solid fa-door-open"></i> Classroom
                </label>

                <select
                    id="classroom"
                    name="classroom"
                    required
                    class="select-control"
                >
                    <option value="">Select classroom...</option>

                    {% for classroom in classrooms %}

                        <option value="{{ classroom.id }}">{{ classroom.display_name }}</option>

                    {% endfor %}

                </select>
            </div>
        </div>

        <div class="form-grid-two">
            <div>
                <label for="subject" class="field-label">
                    <i class="fa-solid fa-book"></i> Subject
                </label>

                <select
                    id="subject"
                    name="subject"
                    required
                    class="select-control"
                >
                    <option value="">Select subject...</option>

                    {% for subject in subjects %}

                        <option value="{{ subject.id }}">{{ subject.display_name }}</option>

                    {% endfor %}

                </select>
            </div>

            <div>
                <label for="course" class="field-label">
                    <i class="fa-solid fa-graduation-cap"></i> Course
                </label>

                <select
                    id="course"
                    name="course"
                    required
                    class="select-control"
                >
                    <option value="">Select course...</option>

                    {% for course in courses %}

                        <option value="{{ course.id }}">{{ course.display_name }}</option>

                    {% endfor %}

                </select>
            </div>
        </div>

        <div>
            <label for="group" class="field-label">
                <i class="fa-solid fa-people-group icon-group"></i> Group
            </label>

            <select
                id="group"
                name="group"
                required
                class="select-control"
            >
                <option value="">Select group...</option>

                {% for group in groups %}

                    <option value="{{ group.id }}">{{ group.display_name }}</option>

                {% endfor %}

            </select>
        </div>

        <div>
            <label for="date" class="field-label">
                <i class="fa-solid fa-calendar-days"></i> Date
            </label>

            <input
                type="date"
                id="date"
                name="date"
                required
                class="select-control"
            />
        </div>

        <div class="form-grid-two">
            <div>
                <label for="start_time" class="field-label">
                    <i class="fa-solid fa-clock"></i> Start Time
                </label>

                <input
                    type="time"
                    id="start_time"
                    name="start_time"
                    required
                    class="select-control"
                />
            </div>

            <div>
                <label for="end_time" class="field-label">
                    <i class="fa-solid fa-clock"></i> End Time
                </label>

                <input
                    type="time"
                    id="end_time"
                    name="end_time"
                    required
                    class="select-control"
                />
            </div>
        </div>

        <div>
            <label>
                <input
                    type="checkbox"
                    id="is_recurring"
                    name="is_recurring"
                />
                <span class="recurring-toggle__label">
                    <i class="fa-solid fa-rotate-right"></i>
                    Recurring entry
                </span>
            </label>

            <p class="text-secondary text-small mt-4">
                When enabled, additional entries are created on the same day at the interval you choose.
            </p>
        </div>

        <div class="form-grid-two mt-16 recurrence-fields recurrence-fields--hidden" data-recurring-fields hidden aria-hidden="true">
            <div>
                <label for="recurrence_interval_days" class="field-label">
                    <i class="fa-solid fa-calendar-week"></i> Repeat every (days)
                </label>

                <input
                    type="number"
                    id="recurrence_interval_days"
                    name="recurrence_interval_days"
                    min="1"
                    step="1"
                    class="select-control"
                    data-recurring-input
                    disabled
                />
            </div>

            <div>
                <label for="recurrence_total_occurrences" class="field-label">
                    <i class="fa-solid fa-hashtag"></i> Number of occurrences
                </label>

                <input
                    type="number"
                    id="recurrence_total_occurrences"
                    name="recurrence_total_occurrences"
                    min="2"
                    step="1"
                    class="select-control"
                    data-recurring-input
                    disabled
                />

                <p class="text-secondary text-small mt-2">
                    Includes the first scheduled entry.
                </p>
            </div>
        </div>

        <div class="action-buttons">
            <button type="submit" class="chat-submit">
                <i class="fa-solid fa-check"></i>

                Create Entry

            </button>

            <a href="{% url 'scheduler' %}" class="btn-outline">
                <i class="fa-solid fa-xmark"></i>

                Cancel

            </a>
        </div>
    </form>
</div>

{% endblock %}

{% block scripts %}
    {{ block.super }}
    <script>
    document.addEventListener('DOMContentLoaded', function () {
        const toggle = document.getElementById('is_recurring');
        const inputs = document.querySelectorAll('[data-recurring-input]');
        const container = document.querySelector('[data-recurring-fields]');

        if (!toggle) {
            return;
        }

        const applyState = () => {
            const show = toggle.checked;

            if (container) {
                container.hidden = !show;
                container.classList.toggle('recurrence-fields--hidden', !show);
                container.setAttribute('aria-hidden', String(!show));
            }

            inputs.forEach((input) => {
                input.disabled = !show;
                if (!show) {
                    input.value = '';
                }
            });
        };

        applyState();
        toggle.addEventListener('change', applyState);
    });
    </script>
{% endblock %}
