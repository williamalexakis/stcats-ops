{% extends "core/admin_base.html" %}
{% load core_extras %}

{% block title %}Invite Codes - CS Dept Platform{% endblock %}

{% block admin_content %}

<div class="section-header">
    <h1 class="section-header__title">Invite Codes</h1>
</div>

<div class="card card--spaced">
    <div class="card-header">
        <i class="fa-solid fa-ticket icon-teacher"></i>

        <h3 class="card-header__title">Generate Invite Code</h3>
    </div>

    <form method="post" class="form-vertical form-narrow">

        {% csrf_token %}

        <div>
            <label for="uses" class="field-label">

                Number of Uses

            </label>

            <input
                type="number"
                id="uses"
                name="uses"
                value="1"
                min="1"
                required
                class="select-control"
            />
        </div>

        <div>
            <label for="expiry_days" class="field-label">
                Expiration (Days)
            </label>

            <input
                type="number"
                id="expiry_days"
                name="expiry_days"
                placeholder="Leave empty for no expiration"
                min="1"
                class="select-control"
            />
        </div>

        <button type="submit" class="chat-submit">
            <i class="fa-solid fa-plus"></i>

            Generate Code

        </button>
    </form>
</div>

<div class="card">
    <div class="card-header">
        <i class="fa-solid fa-list icon-teacher"></i>

        <h3 class="card-header__title">Active Invite Codes</h3>

        <div class="count-circle count-circle--info">
            {{ invite_codes|length }}
        </div>
    </div>

    {% if invite_codes %}

        <div class="table-scroll">
            <table class="table">
                <thead>
                    <tr class="table__head-row">
                        <th class="table__head-cell">Code</th>
                        <th class="table__head-cell">Creator</th>
                        <th class="table__head-cell text-center">Uses Left</th>
                        <th class="table__head-cell">Expires</th>
                        <th class="table__head-cell text-center">Created</th>
                        <th class="table__head-cell text-center">Actions</th>
                    </tr>
                </thead>

                <tbody>

                    {% for code in invite_codes %}

                        <tr class="table__row">
                            <td class="table__cell">
                                <span class="code-chip">{{ code.code }}</span>
                            </td>

                            <td class="table__cell text-secondary">
                                <div class="table-person">
                                    <div class="avatar {% if code.creator|is_admin %}avatar--admin{% else %}avatar--default{% endif %}">
                                        {{ code.creator.username|first|upper }}
                                    </div>

                                    {{ code.creator.username }}
                                </div>
                            </td>

                            <td class="table__cell text-center">
                                <div class="count-circle count-circle--success">{{ code.remaining_uses }}</div>
                            </td>

                            <td class="table__cell text-small text-secondary">

                                {% if code.expiration_date %}

                                    {{ code.expiration_date|date:"d/m/Y H:i" }}

                                {% else %}

                                    <span class="text-tertiary">Never</span>

                                {% endif %}

                            </td>

                            <td class="table__cell text-center text-small text-secondary">
                                {{ code.creation_date|date:"d/m/Y" }}
                            </td>

                            <td class="table__cell text-center">
                                <form method="post"
                                      action="{% url 'delete_invite_code' code.id %}"
                                      style="display:inline">
                                    {% csrf_token %}
                                    <button type="submit"
                                            onclick="return confirm('Are you sure you want to delete this invite code?');"
                                            class="chat-action chat-action--danger"
                                            title="Delete invite code">
                                        <i class="fa-solid fa-trash"></i>
                                    </button>
                                </form>
                            </td>
                        </tr>

                    {% endfor %}

                </tbody>
            </table>
        </div>

    {% else %}

        <div class="empty-state">
            <i class="fa-solid fa-ticket empty-state__icon"></i>

            <p class="empty-state__text">No invite codes available.</p>
        </div>

    {% endif %}

</div>

{% endblock %}
