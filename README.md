# St. Catherine's CS Department Platform

An internal web platform that supports management and coordination for the St. Catherine's CS department.

> [!IMPORTANT]
> Account creation requires an invite code generated by an admin.

## Features

- **Microsoft SSO** – Signups and logins can be performed via Azure AD.
- **Role Management** – Promote, demote, or remove users through the members view.
- **Scheduling System** – Manage lessons through a calendar-style scheduler; export filtered schedules as `.csv` files.
- **Code Editor** – Run Python code in-browser; import `.py` files and export current code.
- **Audit Trail** – Every POST request and admin action is logged and reviewable.

## Localhost Setup

### Prerequisites

- Python 3.11+
- A database connection string (SQLite or PostgreSQL)

### Site

1. Run the following commands:
    ```sh
    git clone git@github.com:<org>/stcats-cs.git
    cd stcats-cs
    python3 -m venv venv
    source venv/bin/activate
    pip install -r requirements.txt
    ```

2. Create a `.env` file with the following configuration:
    ```sh
    DEBUG=True                         # Set to False in production
    SECRET_KEY=change-me               # Provide a unique secret in production
    DATABASE_URL=sqlite:///db.sqlite3  # Or e.g. postgres://user:pass@localhost:5432/stcats for PostgreSQL
    ALLOWED_HOSTS=127.0.0.1,localhost  # Set to website name in production
    CSRF_TRUSTED_ORIGINS=http://127.0.0.1:8000,http://localhost:8000  # Set to valid URI in production
    SESSION_COOKIE_SAMESITE=Lax               # Required for Microsoft redirects
    CSRF_COOKIE_SAMESITE=Lax                  # Required for Microsoft redirects
    SOCIAL_AUTH_AZUREAD_OAUTH2_KEY=...        # Azure AD application (client) ID
    SOCIAL_AUTH_AZUREAD_OAUTH2_SECRET=...     # Azure AD client secret
    SOCIAL_AUTH_AZUREAD_OAUTH2_TENANT_ID=...  # Azure AD tenant ID (GUID)
    SOCIAL_AUTH_REDIRECT_IS_HTTPS=False       # Set True behind HTTPS proxy
    ```

3. Run the following commands:
    ```sh
    python manage.py migrate
    python manage.py seed_groups
    python manage.py createsuperuser
    python manage.py runserver
    ```

4. Visit <http://localhost:8000/admin/> and log in with your superuser credentials.

## Management Commands

| Command | Purpose |
| --- | --- |
| `python manage.py seed_groups` | Ensure the `teacher` and `admin` groups exist; safe to run multiple times. |
| `python manage.py cleanup_invites` | Remove expired or fully consumed invite codes. |
| `python manage.py cleanup_schedule` | Remove finished schedule entries. |
| `python manage.py test` | Run the Django unit test suite. |
